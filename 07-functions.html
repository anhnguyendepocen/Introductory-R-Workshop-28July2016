<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="generator" content="pandoc">
    <title>Research Platforms: R for reproducible scientific analysis</title>
    <link rel="shortcut icon" type="image/x-icon" href="img/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap/bootstrap.css"  />
    <link rel="stylesheet" type="text/css" href="css/swc.css" />
    <link rel="alternate" type="application/rss+xml" title="ResBaz" href="melbourne.resbaz.edu.au"/>
    <link rel="alternate" type="application/rss+xml" title="ResBaz" href="melbourne.resbaz.edu.au"/>
    <meta charset="UTF-8" />
    <meta http-equiv="last-modified" content="{{site.timestamp}}" />
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body class="lesson">
    <div class="container card">
      <div class="banner">
        <a href="http://melbourne.resbaz.edu.au/" title="ResBaz">
          <img alt="ResBaz banner" src="img/ResBaz-banner.png"/>
        </a>
      </div>
      <article>
      <div class="row">
        <div class="col-md-10 col-md-offset-1">
                    <a href="index.html"><h1 class="title">R for reproducible scientific analysis</h1></a>
          <h2 class="subtitle">Creating functions</h2>
          <section class="objectives panel panel-warning">
<div class="panel-heading">
<h2><span class="glyphicon glyphicon-certificate"></span>Learning Objectives</h2>
</div>
<div class="panel-body">
<ul>
<li>Define a function that takes arguments.</li>
<li>Return a value from a function.</li>
<li>Test a function.</li>
<li>Set default values for function arguments.</li>
<li>Explain why we should divide programs into small, single-purpose functions.</li>
</ul>
</div>
</section>
<p>If we only had one data set to analyze, it would probably be faster to load the file into a spreadsheet and use that to plot simple statistics. However, data may be updated periodically, and we may want to pull in that new information later and re-run our analysis again. We may also obtain similar data from a different source in the future.</p>
<p>In this lesson, we’ll learn how to write a function so that we can repeat several operations with a single command.</p>
<aside class="callout panel panel-info">
<div class="panel-heading">
<h2><span class="glyphicon glyphicon-pushpin"></span>What is a function?</h2>
</div>
<div class="panel-body">
<p>Functions gather a sequence of operations into a whole, preserving it for ongoing use. Functions provide:</p>
<ul>
<li>a name we can remember and invoke it by</li>
<li>relief from the need to remember the individual operations</li>
<li>a defined set of inputs and expected outputs</li>
<li>rich connections to the larger programming environment</li>
</ul>
<p>As the basic building block of most programming languages, user-defined functions constitute “programming” as much as any single abstraction can. If you have written a function, you are a computer programmer.</p>
</div>
</aside>
<h2 id="defining-a-function">Defining a function</h2>
<p>Let’s open a new R script file in the <code>functions/</code> directory and call it functions-lesson.R.</p>
<pre class="sourceCode r"><code class="sourceCode r">my_sum &lt;-<span class="st"> </span>function(a, b) {
  the_sum &lt;-<span class="st"> </span>a +<span class="st"> </span>b
  <span class="kw">return</span>(the_sum)
}</code></pre>
<p>Let’s define a function fahr_to_kelvin that converts temperatures from Fahrenheit to Kelvin:</p>
<!-- all of the boredom-->

<pre class="sourceCode r"><code class="sourceCode r">fahr_to_kelvin &lt;-<span class="st"> </span>function(temp) {
  kelvin &lt;-<span class="st"> </span>((temp -<span class="st"> </span><span class="dv">32</span>) *<span class="st"> </span>(<span class="dv">5</span> /<span class="st"> </span><span class="dv">9</span>)) +<span class="st"> </span><span class="fl">273.15</span>
  <span class="kw">return</span>(kelvin)
}</code></pre>
<p>We define <code>fahr_to_kelvin</code> by assigning it to the output of <code>function</code>. The list of argument names are contained within parentheses. Next, the <a href="reference.html#function-body">body</a> of the function–the statements that are executed when it runs–is contained within curly braces (<code>{}</code>). The statements in the body are indented by two spaces. This makes the code easier to read but does not affect how the code operates.</p>
<p>When we call the function, the values we pass to it are assigned to those variables so that we can use them inside the function. Inside the function, we use a <a href="reference.html#return-statement">return statement</a> to send a result back to whoever asked for it.</p>
<aside class="callout panel panel-info">
<div class="panel-heading">
<h2><span class="glyphicon glyphicon-pushpin"></span>Tip</h2>
</div>
<div class="panel-body">
<p>One feature unique to R is that the return statement is not required. R automatically returns whichever variable is on the last line of the body of the function. Since we are just learning, we will explicitly define the return statement.</p>
</div>
</aside>
<p>Let’s try running our function. Calling our own function is no different from calling any other function:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># freezing point of water</span>
<span class="kw">fahr_to_kelvin</span>(<span class="dv">32</span>)</code></pre>
<pre class="output"><code>[1] 273.15
</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># boiling point of water</span>
<span class="kw">fahr_to_kelvin</span>(<span class="dv">212</span>)</code></pre>
<pre class="output"><code>[1] 373.15
</code></pre>
<section class="challenge panel panel-success">
<div class="panel-heading">
<h2><span class="glyphicon glyphicon-pencil"></span>Challenge 1</h2>
</div>
<div class="panel-body">
<p>Write a function called <code>kelvin_to_celsius</code> that takes a temperature in Kelvin and returns that temperature in Celsius</p>
<p>Hint: To convert from Kelvin to Celsius you minus 273.15</p>
</div>
</section>
<h2 id="combining-functions">Combining functions</h2>
<p>The real power of functions comes from mixing, matching and combining them into ever large chunks to get the effect we want.</p>
<p>Let’s define two functions that will convert temperature from Fahrenheit to Kelvin, and Kelvin to Celsius:</p>
<pre class="sourceCode r"><code class="sourceCode r">fahr_to_kelvin &lt;-<span class="st"> </span>function(temp) {
  kelvin &lt;-<span class="st"> </span>((temp -<span class="st"> </span><span class="dv">32</span>) *<span class="st"> </span>(<span class="dv">5</span> /<span class="st"> </span><span class="dv">9</span>)) +<span class="st"> </span><span class="fl">273.15</span>
  <span class="kw">return</span>(kelvin)
}

kelvin_to_celsius &lt;-<span class="st"> </span>function(temp) {
  celsius &lt;-<span class="st"> </span>temp -<span class="st"> </span><span class="fl">273.15</span>
  <span class="kw">return</span>(celsius)
}</code></pre>
<section class="challenge panel panel-success">
<div class="panel-heading">
<h2><span class="glyphicon glyphicon-pencil"></span>Challenge 2</h2>
</div>
<div class="panel-body">
<p>Define the function to convert directly from Fahrenheit to Celsius, by reusing the two functions above (or using your own functions if you prefer).</p>
</div>
</section>
<h2 id="applying-functions-to-datasets">Applying functions to datasets</h2>
<p>We’re going to define a function that calculates the average year of birth in our health dataset:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Takes a dataset and calculates the average year of birth for a</span>
<span class="co"># specified study group.</span>
calcBirthYearAverage &lt;-<span class="st"> </span>function(dat) {
  birthYearAverage &lt;-<span class="st"> </span><span class="kw">mean</span>(dat$birthYear)
  <span class="kw">return</span>(birthYearAverage)
}</code></pre>
<p>We define <code>calcBirthYearAverage</code> by assigning it to the output of <code>function</code>. The list of argument names are contained within parentheses. Next, the body of the function – the statements executed when you call the function – is contained within curly braces (<code>{}</code>).</p>
<p>We’ve indented the statements in the body by two spaces. This makes the code easier to read but does not affect how it operates.</p>
<p>When we call the function, the values we pass to it are assigned to the arguments, which become variables inside the body of the function.</p>
<p>Inside the function, we use the <code>return</code> function to send back the result. This return function is optional: R will automatically return the results of whatever command is executed on the last line of the function.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">calcBirthYearAverage</span>(healthData)</code></pre>
<pre class="output"><code>[1] 1933.588
</code></pre>
<p>That’s not very informative, since the dataset comprises data from two studies that were performed decades apart. Let’s add another argument so we can calculate the average year of birth for a particular study group.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Takes a dataset and calculates the average year of birth for a</span>
<span class="co"># specified study group.</span>
calcBirthYearAverage &lt;-<span class="st"> </span>function(dat, <span class="dt">group =</span> <span class="dv">1</span>) {
  birthYearAverage &lt;-<span class="st"> </span><span class="kw">mean</span>(dat[dat$HIGroup ==<span class="st"> </span>group, ]$birthYear)
  <span class="kw">return</span>(birthYearAverage)
}</code></pre>
<p>If you’ve been writing these functions down into a separate R script (a good idea!), you can load in the functions into our R session by using the <code>source</code> function:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">source</span>(<span class="st">&quot;functions/functions-lesson.R&quot;</span>)</code></pre>
<p>The function now subsets the provided data by group before taking the average year of birth. A default value of 1 is given for group, so that if no value is specified when you call the function, the result of the function will be for group 1. You need to be careful when setting default values; sometimes you can get some unexpected behaviour from functions if you don’t realise that an argument has a default value.</p>
<p>Let’s take a look at what happens when we specify the study group:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">calcBirthYearAverage</span>(healthData,<span class="dv">0</span>)</code></pre>
<pre class="output"><code>[1] NaN
</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">calcBirthYearAverage</span>(healthData,<span class="dv">1</span>)</code></pre>
<pre class="output"><code>[1] NaN
</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">calcBirthYearAverage</span>(healthData)</code></pre>
<pre class="output"><code>[1] NaN
</code></pre>
<p>What if we want to look at the average year of birth for specific year levels?</p>
<section class="challenge panel panel-success">
<div class="panel-heading">
<h2><span class="glyphicon glyphicon-pencil"></span>Challenge 3</h2>
</div>
<div class="panel-body">
<p>Define the function to calculate the average year of birth for specific year levels of a single study group. Hint: Look up the function %in%, which will allow you to subset by multiple year levels</p>
</div>
</section>
<aside class="callout panel panel-info">
<div class="panel-heading">
<h2><span class="glyphicon glyphicon-pushpin"></span>Tip: Pass by value</h2>
</div>
<div class="panel-body">
<p>Functions in R almost always make copies of the data to operate on inside of a function body. If we were to modify <code>dat</code> inside the function we are modifying the copy of the health study dataset stored in <code>dat</code>, not the original variable we gave as the first argument.</p>
<p>This is called “pass-by-value” and it makes writing code much safer: you can always be sure that whatever changes you make within the body of the function, stay inside the body of the function.</p>
</div>
</aside>
<aside class="callout panel panel-info">
<div class="panel-heading">
<h2><span class="glyphicon glyphicon-pushpin"></span>Tip: Function scope</h2>
</div>
<div class="panel-body">
<p>Another important concept is scoping: any variables (or functions!) you create or modify inside the body of a function only exist for the lifetime of the function’s execution. When we call <code>calcBirthYearAverage</code>, the variables <code>dat</code>, <code>group</code> and <code>birthYearAverage</code> only exist inside the body of the function. Even if we have variables of the same name in our interactive R session, they are not modified in any way when executing a function.</p>
</div>
</aside>
<section class="challenge panel panel-success">
<div class="panel-heading">
<h2><span class="glyphicon glyphicon-pencil"></span>Challenge 4</h2>
</div>
<div class="panel-body">
<p>The <code>paste</code> function can be used to combine text together, e.g:</p>
<pre class="sourceCode r"><code class="sourceCode r">best_practice &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Write&quot;</span>, <span class="st">&quot;programs&quot;</span>, <span class="st">&quot;for&quot;</span>, <span class="st">&quot;people&quot;</span>, <span class="st">&quot;not&quot;</span>, <span class="st">&quot;computers&quot;</span>)
<span class="kw">paste</span>(best_practice, <span class="dt">collapse=</span><span class="st">&quot; &quot;</span>)</code></pre>
<pre class="output"><code>[1] &quot;Write programs for people not computers&quot;
</code></pre>
<p>Write a function called <code>fence</code> that takes two vectors as arguments, called <code>text</code> and <code>wrapper</code>, and prints out the text wrapped with the <code>wrapper</code>:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">fence</span>(<span class="dt">text=</span>best_practice, <span class="dt">wrapper=</span><span class="st">&quot;***&quot;</span>)</code></pre>
<p><em>Note:</em> the <code>paste</code> function has an argument called <code>sep</code>, which specifies the separator between text. The default is a space: &quot; “. The default for <code>paste0</code> is no space”“.</p>
</div>
</section>
<aside class="callout panel panel-info">
<div class="panel-heading">
<h2><span class="glyphicon glyphicon-pushpin"></span>Tip</h2>
</div>
<div class="panel-body">
<p>R has some unique aspects that can be exploited when performing more complicated operations. We will not be writing anything that requires knowledge of these more advanced concepts. In the future when you are comfortable writing functions in R, you can learn more by reading the <a href="http://cran.r-project.org/doc/manuals/r-release/R-lang.html#Environment-objects">R Language Manual</a> or this <a href="http://adv-r.had.co.nz/Environments.html">chapter</a> from <a href="http://adv-r.had.co.nz/">Advanced R Programming</a> by Hadley Wickham. For context, R uses the terminology “environments” instead of frames.</p>
</div>
</aside>
<aside class="callout panel panel-info">
<div class="panel-heading">
<h2><span class="glyphicon glyphicon-pushpin"></span>Tip: Testing and documenting</h2>
</div>
<div class="panel-body">
<p>It’s important to both test functions and document them: Documentation helps you, and others, understand what the purpose of your function is, and how to use it, and its important to make sure that your function actually does what you think.</p>
<p>When you first start out, your workflow will probably look a lot like this:</p>
<ol style="list-style-type: decimal">
<li>Write a function</li>
<li>Comment parts of the function to document its behaviour</li>
<li>Load in the source file</li>
<li>Experiment with it in the console to make sure it behaves as you expect</li>
<li>Make any necessary bug fixes</li>
<li>Rinse and repeat.</li>
</ol>
<p>Formal documentation for functions, written in separate <code>.Rd</code> files, gets turned into the documentation you see in help files. The <a href="http://cran.r-project.org/web/packages/roxygen2/vignettes/rd.html">roxygen2</a> package allows R coders to write documentation alongside the function code and then process it into the appropriate <code>.Rd</code> files. You will want to switch to this more formal method of writing documentation when you start writing more complicated R projects.</p>
<p>Formal automated tests can be written using the <a href="http://r-pkgs.had.co.nz/tests.html">testthat</a> package.</p>
</div>
</aside>
<h2 id="challenge-solutions">Challenge solutions</h2>
<section class="challenge panel panel-success">
<div class="panel-heading">
<h2><span class="glyphicon glyphicon-pencil"></span>Solution to challenge 1</h2>
</div>
<div class="panel-body">
<p>Write a function called <code>kelvin_to_celsius</code> that takes a temperature in Kelvin and returns that temperature in Celsius</p>
<pre class="sourceCode r"><code class="sourceCode r">kelvin_to_celsius &lt;-<span class="st"> </span>function(temp) {
 celsius &lt;-<span class="st"> </span>temp -<span class="st"> </span><span class="fl">273.15</span>
 <span class="kw">return</span>(celsius)
}</code></pre>
</div>
</section>
<section class="challenge panel panel-success">
<div class="panel-heading">
<h2><span class="glyphicon glyphicon-pencil"></span>Solution to challenge 2</h2>
</div>
<div class="panel-body">
<p>Define the function to convert directly from Fahrenheit to Celsius, by reusing these two functions above</p>
<pre class="sourceCode r"><code class="sourceCode r">fahr_to_celsius &lt;-<span class="st"> </span>function(temp) {
  temp_k &lt;-<span class="st"> </span><span class="kw">fahr_to_kelvin</span>(temp)
  result &lt;-<span class="st"> </span><span class="kw">kelvin_to_celsius</span>(temp_k)
  <span class="kw">return</span>(result)
}</code></pre>
</div>
</section>
<section class="challenge panel panel-success">
<div class="panel-heading">
<h2><span class="glyphicon glyphicon-pencil"></span>Solution to challenge 3</h2>
</div>
<div class="panel-body">
<p>Define the function to calculate the average year of birth for specific year levels of a single study group. Hint: Look up the function %in%, which will allow you to subset by multiple year levels</p>
<pre class="sourceCode r"><code class="sourceCode r">calcBirthYearAverage &lt;-<span class="st"> </span>function(dat, group, yearLevel) {
  birthYearAverage &lt;-<span class="st"> </span><span class="kw">mean</span>(dat[dat$HIGroup ==<span class="st"> </span>group &amp;<span class="st"> </span>dat$education %in%<span class="st"> </span>yearLevel, ]$birthYear)
  <span class="kw">return</span>(birthYearAverage)
}</code></pre>
</div>
</section>
<section class="challenge panel panel-success">
<div class="panel-heading">
<h2><span class="glyphicon glyphicon-pencil"></span>Solution to challenge 4</h2>
</div>
<div class="panel-body">
<p>Write a function called <code>fence</code> that takes two vectors as arguments, called <code>text</code> and <code>wrapper</code>, and prints out the text wrapped with the <code>wrapper</code>:</p>
<pre class="sourceCode r"><code class="sourceCode r">fence &lt;-<span class="st"> </span>function(text, wrapper){
  text &lt;-<span class="st"> </span><span class="kw">c</span>(wrapper, text, wrapper)
  result &lt;-<span class="st"> </span><span class="kw">paste</span>(text, <span class="dt">collapse =</span> <span class="st">&quot; &quot;</span>)
  <span class="kw">return</span>(result)
}
best_practice &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Write&quot;</span>, <span class="st">&quot;programs&quot;</span>, <span class="st">&quot;for&quot;</span>, <span class="st">&quot;people&quot;</span>, <span class="st">&quot;not&quot;</span>, <span class="st">&quot;computers&quot;</span>)
<span class="kw">fence</span>(<span class="dt">text=</span>best_practice, <span class="dt">wrapper=</span><span class="st">&quot;***&quot;</span>)</code></pre>
<pre class="output"><code>[1] &quot;*** Write programs for people not computers ***&quot;
</code></pre>
</div>
</section>
        </div>
      </div>
      </article>
    <!--  <div class="footer">
  <a class="label swc-blue-bg" href="http://software-carpentry.org">Software Carpentry</a>
  <a class="label swc-blue-bg" href="https://github.com/swcarpentry/lesson-template">Source</a>
  <a class="label swc-blue-bg" href="mailto:admin@software-carpentry.org">Contact</a>
  <a class="label swc-blue-bg" href="LICENSE.html">License</a>
</div> -->
    </div>
    <!-- Javascript placed at the end of the document so the pages load faster -->
    <script src="http://software-carpentry.org/v5/js/jquery-1.9.1.min.js"></script>
    <script src="css/bootstrap/bootstrap-js/bootstrap.js"></script>
    <script src='https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>
    <script src="{{page.root}}/js/jquery-1.9.1.min.js"></script>
    <script src="{{page.root}}/css/bootstrap/bootstrap-js/bootstrap.js"></script>
  </body>
</html>
